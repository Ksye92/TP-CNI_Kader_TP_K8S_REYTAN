# Preservation de l'IP source

## Deployer l'application Guestbook déjà vu précedemment
Utilisez un replica à 1 pour plus de simplicité.

## A l'interieur du Cluster
Depuis un pod de test, tester l'acces à l'application Guestbook
Regardez les logs de l'application pour identifier l'IP source

## Depuis l'exterieur
Depuis l'extérieur, faites la même manipulation, plusieurs fois.
Vous constatez que l'IP vue depuis le frontend est changeante.

## Modifier le `externalTrafficPolicy=Local`
Modifier le service pour que le champ `externalTrafficPolicy` soit à `Local` (et non `Cluster` comme par défaut) :
    
    ```bash
    kubectl patch svc frontend -p '{"spec":{"externalTrafficPolicy":"Local"}}'
    ```
De nouveau consultez le site depuis l'extérieur, et constatez que l'IP source est maintenant stable.
Augmentez le nombre de replicas du frontend à 3, et constatez que l'IP source est toujours stable mais que la répartition n'est pas de 1/3 sur chaque noeud, plutot 2/3 sur un noeud et 1/3 sur l'autre.

