# Routage et Annonce BGP

## Prépration à utilisation de kind et containerlab


## Installation d'outils
```shell
snap install kubectl --classic
snap install helm --classic
apt install -y net-tools
apt install -y yamllint

ufw disable
apt install -y mosh
```

## Installation d'outils pour k8s

```shell
sudo git clone https://github.com/ahmetb/kubectx /opt/kubectx
sudo ln -s /opt/kubectx/kubectx /usr/local/bin/kubectx
sudo ln -s /opt/kubectx/kubens /usr/local/bin/kubens


wget https://github.com/instrumenta/kubeval/releases/latest/download/kubeval-linux-amd64.tar.gz
tar xf kubeval-linux-amd64.tar.gz
sudo cp kubeval /usr/local/bin

curl -LO https://github.com/kvaps/kubectl-node-shell/raw/master/kubectl-node_shell
chmod +x ./kubectl-node_shell
sudo mv ./kubectl-node_shell /usr/local/bin/kubectl-node_shel
```

## Installation de Cilium-cli

```shell
CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/master/stable.txt)
CLI_ARCH=amd64
if [ "$(uname -m)" = "aarch64" ]; then CLI_ARCH=arm64; fi
curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}
sha256sum --check cilium-linux-${CLI_ARCH}.tar.gz.sha256sum
sudo tar xzvfC cilium-linux-${CLI_ARCH}.tar.gz /usr/local/bin
rm cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}

cilium version
```

## Installation de kind

```shell
curl -L "https://kind.sigs.k8s.io/dl/v0.14.0/kind-$(uname)-amd64" -o /usr/local/bin/kind
chmod a+x /usr/local/bin/kind 
```

## Installation de containerlab

```shell
echo "deb [trusted=yes] https://apt.fury.io/netdevops/ /" | \
sudo tee -a /etc/apt/sources.list.d/netdevops.list

apt update && apt install containerlab
```

## Récupération des fichiers de configuration

```shell
git clone YAML // TODO
```

## Lancement de kind

```shell
kind delete cluster && kind create cluster --config=kind-config.yaml

kubectl cluster-info --context kind-kind

kubectl get nodes
```

Les noeuds restent en NotReady car le CNI n’est pas installé

## Installation de Cilium

```shell
helm upgrade --install --namespace kube-system --repo https://helm.cilium.io cilium cilium --values values.yaml

cilium status

kubectl -n kube-system exec ds/cilium -- cilium status --verbose



[Revenir au sommaire](../README.md) | [TP Suivant](./TP14.md)